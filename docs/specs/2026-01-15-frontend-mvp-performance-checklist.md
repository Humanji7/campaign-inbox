# Frontend MVP Performance Checklist (subset)
Дата: 2026-01-15  
Источник: Vercel React Best Practices (`AGENTS.md`)  
Цель: короткий набор правил (10–12), который мы применяем с первой строки UI-кода в MVP.

Контекст проекта: PWA (Vite + React + TS) + Tailwind + shadcn/ui, state=Zustand, gestures=@use-gesture/react.

## Как использовать
- Перед мерджем UI-изменений пробежать чек-лист.
- Это **MVP subset**, не полный стандарт; полный стандарт — `AGENTS.md`.

## 1) Async / Waterfalls (CRITICAL)
1. **Не делай последовательных `await`, если можно параллельно.**  
   - Стартуй независимые запросы сразу, `await` — позже, `Promise.all` для независимого.
2. **Не загружай данные “цепочкой” из компонентов/эффектов.**  
   - Один “инициатор” запроса, остальные читают кэш/результат.

## 2) Bundle size / Loading (CRITICAL)
3. **Не использовать barrel imports для тяжёлых либ.**  
   - Если библиотека имеет дорогие “index re-exports”, импортируй напрямую из нужного модуля.
4. **Код-сплитить тяжёлые экраны/модалки.**  
   - `React.lazy`/динамические импорты для “редких” фич: Full preview, Quick edit, Ship modal.
5. **Не тащить третьи библиотеки в initial bundle без нужды.**  
   - Аналитику/логгинг/эксперименты грузить после первого взаимодействия/idle (если вообще появятся).

## 3) Fetching / Caching (MEDIUM-HIGH)
6. **Дедуп запросов и кэш по ключу.**  
   - Для “read” запросов использовать SWR (или эквивалент) с единым fetcher.
7. **Кэшировать дорогие вычисления локально, если входы одинаковые.**  
   - Например, “facts extraction” результаты кэшируются на сервере (Edge), а клиент — только читает.

## 4) Re-renders / State (MEDIUM)
8. **Zustand: подписываться на производные/узкие селекторы.**  
   - Компонент не должен ререндериться от “всего стора”, только от нужных примитивов/derived bool.
9. **Не подписываться на state, который нужен только в callback.**  
   - Читать “на demand” внутри handler (или хранить в ref), а не держать подписку на каждый чих.
10. **`setState(curr => …)` для обновлений от текущего значения.**

## 5) Rendering / Lists (MEDIUM)
11. **Длинные списки: избегать лишнего DOM.**  
   - Минимизировать элементы, использовать `content-visibility` для тяжёлых списков, рассмотреть windowing позже.
12. **Условный рендер: явные ветки вместо `&&`, когда это влияет на layout/перф.**

## Definition of Done для UI PR
- Нет очевидных водопадов в async.
- Тяжёлые части (preview/edit/ship) вынесены в lazy-loaded chunks.
- Нет barrel-import паттерна для тяжёлых пакетов.
- Zustand селекторы узкие; нет лишних подписок.

