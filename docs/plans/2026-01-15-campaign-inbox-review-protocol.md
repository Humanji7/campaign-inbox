# Campaign Inbox — протокол подготовки к ревью (taste-first)  
Дата: 2026-01-15  
Основание: `PLAN.md` (MVP Implementation Plan)

## 0) Контекст и цель ревью

Продукт: категория “для пользователей X/Twitter, которые хотят публиковать регулярно”, цель — **снизить трение до публикации** и поддерживать **постоянную активную публикацию**.

Ключевая особенность: “вкус/голос/перо” у большинства пользователей **не сформулирован** и находится в процессе ресерча. Поэтому на этом этапе мы утверждаем **не “идеальный вкус”**, а **механизм**, который:

- работает при неизвестном вкусе (в т.ч. “не знаю” на большинство вопросов),
- даёт быстрый полезный результат,
- позволяет улучшать вкус ежедневно маленькими шагами,
- минимизирует дорогие переделки (рефактор/миграции/сломанные флоу).

## 1) Модель принятия решений (ты + ИИ)

Роли:
- **Ты** — владелец ограничителей и финального “вето” (sign-off). Твой вклад — направление, ощущения, “это ок/не ок”, рамки и запреты.
- **ИИ** — проектирует, предлагает варианты, оформляет артефакты, пишет код/сборку, но **не “утверждает”**.

Режим (C + D):
- **Авто-утверждение (C):** всё, что соответствует заранее заданным принципам, считается утверждённым.
- **Вето/ощущения (D):** ты вмешиваешься, когда видишь будущий рефактор, трение, “не нравится”, или риск увести продукт не туда.

## 2) Гейты (что надо утвердить до имплементации)

### Gate A — Stack decision pass (стек можно менять)
Цель: выбрать стек под цель MVP и риски (PWA/clipboard/deeplink), зафиксировать как “стек MVP”.

Выход:
- один выбранный стек (можно отличный от `PLAN.md`, но с явной причиной),
- чек-лист “почему он минимизирует трение”,
- правила, когда стек можно менять (только если ломается критерий).

### Gate B — Design sign-off
Цель: утвердить UX-потоки, экраны, состояния, анкету вкуса и её “прогрессивность”.

Выход:
- карта экранов (IA) + основной flow из `PLAN.md` “Verification”,
- описание UI состояний (empty/loading/error),
- анкета вкуса v1 + правила “не знаю/пропустить/по умолчанию”,
- формат ежедневного дизайн-паса и лога решений.

### Gate C — Tech sign-off
Цель: утвердить **контракт ядра** и разделение “ядро ↔ вкус”, чтобы вкус можно было улучшать без дорогих переделок.

Выход:
- Domain Contract v1 (минимальный стабильный контракт),
- Taste System Spec v1 (версионирование, хранение, как влияет на генерацию),
- Supabase schema черновик с пониманием миграций/RLS (минимум).

## 3) “Золотой путь” (MVP, не обсуждаем)

Один золотой путь — это `PLAN.md` → раздел “Verification”:

1. Generate card via Pack  
2. See card in Inbox  
3. Swipe → Ship flow  
4. Copy + Open X  
5. Paste URL → card in History

Любая задача в MVP должна улучшать один из этих шагов или устранять баг/трение, которое мешает этим шагам.

Ограничения генерации/публикации для MVP (уточнено):
- внутри продукта **есть LLM**, но генерация остаётся **template-based**: предсказуемые промпт‑шаблоны + структурные поля вкуса + факты/сигналы из данных.
- публикация в X — через **copy + deeplink**, без OAuth и прямой отправки.

## 4) Артефакты для ревью (Review Pack)

Собирается **до** первого дизайн-ревью и обновляется между дизайн-пасами.

Файлы в репозитории (текущий пакет):
- `docs/ai/INIT.md`
- `docs/decisions/2026-01-15-decision-log.md`
- `docs/specs/2026-01-15-ux-ia-and-flows-v1.md`
- `docs/specs/2026-01-15-domain-contract-v1.md`
- `docs/specs/2026-01-15-taste-system-spec-v1.md`
- `docs/specs/2026-01-15-build-in-public-pack-spec-v1.md`
- `docs/specs/2026-01-15-stack-decision-pass-v1.md`
- `docs/specs/2026-01-15-supabase-schema-rls-v1.md`

### 4.0 Чек-лист подготовки (T-48h / T-24h / T-0)
T-48h:
- выбрать формат артефактов на ближайшую неделю (текст/макеты/прототип),
- собрать `PRD-lite` + “золотой путь” + out-of-scope.

T-24h:
- собрать UX flow map (1 лист),
- собрать список экранов и их задач,
- принести черновик анкеты вкуса v1 (без идеального текста — важна структура/правила).

T-0 (перед дизайн-пасом):
- выбрать 1 сценарий дня,
- подготовить “контрольный снимок” (прототип/макет/текстовые экраны),
- открыть Decision Log и записать тему.

### 4.1 PRD-lite (1–2 страницы)
- проблема/цель/кому,
- “что считаем успехом” (метрики можно без аналитики: субъективно/ручной лог),
- out-of-scope из `PLAN.md`,
- ограничения (вкус неизвестен, исследуется).

### 4.2 UX flows
- схема основного flow (Pack → Inbox → Ship → History),
- схема “NeedsInfo” (почему карточка туда попадает, что с ней делать),
- схема “Quick edit” и “Risk chips”.

### 4.3 Экранная спецификация
Экраны по `PLAN.md`:
- Tabs: Inbox / History / Packs / Settings
- Inbox: Ready / NeedsInfo + swipe right=Ship, left=Kill
- Card Detail: full preview
- Quick Edit: bottom sheet + version tracking on save
- Ship Flow: multi-step modal + clipboard copy + deeplink + URL confirm + статус `posted`
- History: список posted + URL + snippet + timestamp
- Packs: Build-in-public pack + input form + template-based generation + Card → Inbox

Для каждого экрана:
- основная задача пользователя,
- состояния (empty/loading/error),
- действия,
- “что будет считаться трением”.

### 4.4 Domain Contract v1 (минимум стабильного)
Цель: минимально-необходимые поля, которые не хочется ломать в процессе ресерча вкуса.

Список сущностей из `PLAN.md`:
- `ActionCard`
- `RiskChip`
- `FixAction`

Дополнительно (taste-first):
- `TasteProfile` или `TastePack` (версионируемый профиль вкуса)

Важно: вкус не должен требовать постоянных миграций “ядра карточки”.

### 4.5 Taste System Spec v1
См. раздел 5.

### 4.6 Packs Spec v1 (информационные паки)
Требование: паки должны быть “с информацией”, а не пустыми шаблонами.

Для MVP основной источник — **активности пользователя в проектах**, в первую очередь **git commits**.

В Review Pack включить:
- список источников данных (минимум: локальный git репозиторий; опционально позже: GitHub/GitLab),
- решение по подключению (MVP): **GitHub OAuth, только public repos**,
- требования к OAuth scopes: без доступа к private репозиториям; цель OAuth — идентификация пользователя и стабильные лимиты API,
- UX правило (MVP): пользователь **сам выбирает репозитории** (чеклист); по умолчанию ничего не выбрано,
- какие сигналы извлекаем из коммитов (messages, changed files, diffs/summary, tags, timestamps),
- правила приватности/безопасности (что не уходит в LLM, что маскируется),
- кэш/лимиты (чтобы “LLM внутри” оставался дешёвым).

Решение по данным для MVP (приватность/простота):
- берём **только commit messages + метаданные** (repo, автор, дата, хэш), **без diff и без содержимого кода**.

### 4.6 Риск‑лист (что может привести к дорогому рефактору)
- изменение схемы БД и миграции,
- попытка “жёстко определить вкус” для людей, которые не знают,
- усложнение ship-потока,
- перепривязка карточек к вкусу без версионирования.

## 5) Taste-first: анкета v1 + progressive refinement (жёсткая, но гибкая)

Принцип: начинаем с анкеты (как ты хочешь), но она должна:
- принимать “болтовой” ввод (ты любишь говорить/писать свободно),
- позволять отвечать **частично** и не ломать MVP,
- включать **progressive refinement** после каждого действия (микро-уточнения),
- иметь хорошие дефолты (чтобы MVP работал “из коробки”).

### 5.1 Модель данных вкуса (требование к дизайну и коду)
Разделение:
- **Ядро**: карточка + статусы + ship/history (меняем редко).
- **Вкус**: профиль вкуса (меняем часто), версионируем.

Требования:
- у вкуса есть `version`,
- карточка хранит ссылку на версию вкуса, под которой она была сгенерирована,
- изменения вкуса не ломают старые карточки (или требуют явного “re-generate”).

### 5.1.1 LLM-пайплайн (2 слоя)
Требование: внутри продукта есть LLM, но генерация остаётся template-based.

Рекомендуемая схема (два вызова):
1) **Facts/Signals LLM (слой “дрова”)**: из данных (commit messages + метаданные) извлекает структурированные “факты/наблюдения/изменения/уроки”.
2) **Template-based LLM**: берёт TasteProfile + факты и генерирует текст карточки по предсказуемым промпт‑шаблонам.

Примечание: модель “слоя дров” может быть условный “Opus” или “GPT-5.2” — это решение отдельно фиксируется в Stack decision pass.

Черновик структуры (логическая, не привязана к БД/коду):

```yaml
TasteProfile:
  id: string
  version: number
  updated_at: string
  # “болтовой” источник истины (может быть пустым)
  raw_notes: string | null

  goal: string | null
  audience: string | null
  topics_allowed: [string]
  topics_banned: [string]

  tone:
    adjectives: [string] # "спокойный", "ироничный", "жёсткий"...
    energy: string | null # low/med/high (или свободный текст)

  format:
    length: string | null # short/medium/long
    structure: [string]   # "hook", "story", "bullets", "cta"
    emojis: string | null # none/low/med/high

  cta:
    intensity: string | null # off/soft/normal/strong
    preferred_types: [string] # "question", "invite", "follow", "reply"

  examples:
    links: [string]
    snippets: [string]
```

### 5.2 Анкета вкуса (жёсткая форма, гибкая семантика)
Формально жёсткая: список вопросов/полей. Семантически гибкая: все поля допускают `unknown`.

Минимальные блоки (рекомендуемые, но не все должны быть обязательными):
1) Цель публикаций (зачем)  
2) Аудитория (для кого)  
3) Темы/табу (что нельзя)  
4) Формат (длина, структура)  
5) Тон/голос/эмоция  
6) CTA (как и когда призывать к действию)  
7) Примеры (ссылки/черновики/“мне нравится вот так”)  

Правила UX:
- у каждого блока есть `Не знаю`, `Пропустить`, `По умолчанию`,
- есть “быстрый режим”: заполнить 2–3 поля и получить первые карточки,
- есть “болтовой режим”: большое поле “опиши как хочешь” → позже раскладываем по блокам.

Набор вопросов анкеты v1 (формат: вопрос → варианты/примечания):
- Цель публикаций: “зачем ты пишешь?” → свободный текст / пресеты (build-in-public, продажи, нетворк, обучение).
- Аудитория: “для кого?” → свободный текст / “не знаю”.
- Темы/табу: “что нельзя?” → список строк / “ничего” / “не знаю”.
- Формат: длина (коротко/средне/длинно) + структура (хук→суть→вывод, bullets, история).
- Тон: 3 прилагательных (или “не знаю”).
- CTA: off/soft/normal/strong (без требований “уметь CTA”).
- Примеры: ссылки/кусочки текста (опционально).

### 5.3 Progressive refinement (встроенный №2)
После каждого Ship (или даже после просмотра карточки) задаём **1 микро‑вопрос**:
- “Больше конкретики / больше эмоции / более нейтрально?”
- “Добавлять CTA чаще / реже / только иногда?”
- “Короче / длиннее?”
- “Больше личного опыта / больше фактов?”

Правило: 1 вопрос за шаг, не анкета заново.

### 5.4 CTA при отсутствии опыта пользователя
CTA не требовать как знание. Вместо этого:
- дефолтная библиотека CTA‑паттернов (нейтральные, мягкие),
- переключатель “CTA: выкл / мягко / обычно / агрессивно”,
- возможность “не использовать CTA” без штрафа.

### 5.5 Отсутствие примеров
Если у пользователя нет примеров:
- используем дефолтные стили (минимально рискованные),
- предлагаем позже добавить один пример “когда будет”.

## 6) Дизайн‑пасы (ты — главный тестер)

Выбранный ритм: **10–15 минут ежедневно** + опционально 45 минут раз в неделю для “закрытия хвостов”.

Скрипт ежедневного дизайн‑паса:
1) Мы смотрим один конкретный сценарий (например: “создать карту из Pack и увидеть в Inbox”).  
2) Ты даёшь 3 сигнала: “нравится/не нравится”, “где трение”, “что неприемлемо”.  
3) Я фиксирую решения в Decision Log и приношу следующий “контрольный снимок”.

## 7) Decision Log (шаблон)

Каждое решение фиксируется коротко, без эссе.

```
Дата:
Тема:
Контекст (1–2 строки):
Варианты (A/B/C):
Выбор:
Причина (1 строка):
Компромиссы/риски:
Что проверяем завтра (design-pass):
```

## 8) Стоп‑триггеры (когда я обязан эскалировать тебе решение)

Я обязан остановиться и спросить “Ок?” до продолжения, если решение меняет:
- навигацию/IA (tabs, назначение экранов),
- доменные статусы/контракт карточки,
- вкус/профиль и его версионирование (особенно связь карточки с вкусом),
- Supabase schema/migrations/RLS,
- Ship flow (deeplink, URL confirm, статус `posted`),
- выбранный стек или ключевые библиотеки.

## 9) Критерии готовности к старту имплементации

Перед кодом должны быть выполнены:
- Gate A: выбран стек MVP + критерии “почему так”,
- Gate B: утверждён UX flow + анкета вкуса v1 + states,
- Gate C: утверждены Domain Contract v1 + Taste System Spec v1 + черновик schema/RLS,
- заполнен Decision Log минимум по 5 ключевым решениям (анкета, taste versioning, ship flow, statuses, packs),
- определён минимальный “информационный” Pack (например Build-in-public на базе commit‑сигналов).

## 10) Шаблоны sign-off (чек-листы)

### 10.1 Stack decision pass — чек-лист
- [ ] Поддерживает PWA + offline/кэш (в разумных пределах)
- [ ] Надёжный clipboard flow
- [ ] Предсказуемое поведение `twitter://post` (и fallback если не сработало)
- [ ] Дешёвый деплой и быстрые итерации
- [ ] Минимум сложных интеграций/SDK
- [ ] Устраивает скорость разработки “ИИ делает код”
- [ ] Есть понятный способ: читать git commits локально и превращать их в “факты для постов”
- [ ] “LLM внутри” укладывается в лимиты по токенам/кэшу (стоимость контролируема)

Выход (1 абзац): “выбран стек X потому что …; меняем только если …”.

### 10.2 Design sign-off — чек-лист
- [ ] Golden path из `PLAN.md` реализуем без трения
- [ ] Есть ясная модель Inbox (Ready/NeedsInfo) и что с ними делать
- [ ] Анкета вкуса v1 допускает “не знаю/пропустить/по умолчанию”
- [ ] Есть “болтовой режим” для ввода вкуса
- [ ] Progressive refinement (1 микро-вопрос) встроен в поток
- [ ] Определены пустые/ошибочные состояния на ключевых экранах

### 10.3 Tech sign-off — чек-лист
- [ ] Контракт `ActionCard`/статусы/версионирование минимален и стабилен
- [ ] Вкус отделён от ядра и версионируется
- [ ] Карточки привязаны к версии вкуса (или есть явный re-generate)
- [ ] Supabase schema/migrations/RLS понятны на уровне черновика
- [ ] Ship flow ограничения (deeplink/URL confirm) формализованы
